<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout & Transaksi</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); max-width: 700px; margin: 20px auto; }
        h2 { color: #38761d; text-align: center; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="text"], input[type="file"], textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .cart-summary { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .cart-summary ul { list-style: none; padding: 0; }
        .cart-summary strong { color: #cc7a00; }
        button { background-color: #38761d; color: white; padding: 10px 15px; margin-top: 20px; border: none; border-radius: 4px; cursor: pointer; width: 100%; }
        button:hover { background-color: #2e6018; }
    </style>
</head>
<body>

<div class="container">
    <h2>Pembayaran & Transaksi ðŸ›’</h2>
    
    <div class="cart-summary">
        <h3>Ringkasan Pesanan</h3>
        <ul id="checkoutItems">
            </ul>
        <p>Total Pembayaran: <strong>Rp. <span id="checkoutTotal">0</span></strong></p>
        <p>Transfer ke Rekening: **Bank ABC - 123456789 (a/n Toko Mendaki)**</p>
    </div>

    <form id="checkoutForm">
        <label for="name">Nama Lengkap</label>
        <input type="text" id="name" required>

        <label for="address">Alamat Pengiriman</label>
        <textarea id="address" rows="3" required></textarea>

        <label for="whatsapp">Nomor WhatsApp (Terisi otomatis)</label>
        <input type="text" id="whatsapp" readonly>
        
        <label for="transferProof">Bukti Transfer (Upload Foto)</label>
        <input type="file" id="transferProof" accept="image/*" required>
        
        <button type="submit">Konfirmasi Pembelian</button>
    </form>
</div>

<script>
// 1. Cek Login
const whatsappNumber = sessionStorage.getItem('whatsappNumber');
const cart = JSON.parse(localStorage.getItem('cart')) || [];

if (!whatsappNumber || cart.length === 0) {
    alert('Keranjang kosong atau Anda belum login.');
    window.location.href = 'index.html'; 
}

// 2. Isi data otomatis
document.getElementById('whatsapp').value = whatsappNumber;

// 3. Tampilkan Ringkasan Keranjang
const checkoutItemsList = document.getElementById('checkoutItems');
const checkoutTotalElement = document.getElementById('checkoutTotal');
let total = 0;

cart.forEach(item => {
    const li = document.createElement('li');
    const itemTotal = item.price * item.quantity;
    li.textContent = `${item.name} (x${item.quantity}) - Rp. ${itemTotal.toLocaleString('id-ID')}`;
    checkoutItemsList.appendChild(li);
    total += itemTotal;
});

checkoutTotalElement.textContent = total.toLocaleString('id-ID');

// 4. Fungsi Submit Transaksi
document.getElementById('checkoutForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Di sini, data harusnya dikirim ke backend. 
    // Karena ini simulasi, kita simpan ringkasan di sessionStorage
    const transactionData = {
        name: document.getElementById('name').value,
        address: document.getElementById('address').value,
        whatsapp: document.getElementById('whatsapp').value,
        total: total,
        items: cart.map(item => `${item.name} x${item.quantity}`)
        // Bukti transfer tidak bisa disimpan tanpa backend, hanya sebagai penanda file terpilih
    };

    sessionStorage.setItem('lastTransaction', JSON.stringify(transactionData));
    localStorage.removeItem('cart'); // Kosongkan keranjang setelah 'pembelian'
    
    window.location.href = 'thankyou.html';
});
</script>

</body>
</html>
