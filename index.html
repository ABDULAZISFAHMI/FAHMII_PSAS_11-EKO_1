<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barang Mendaki - Toko Perlengkapan</title>
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f4f4f4; }
        header { background-color: #38761d; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; padding: 20px; }
        .product-card { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); padding: 15px; text-align: center; }
        .product-card img { width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 10px; }
        .product-card h3 { margin: 10px 0 5px; color: #38761d; }
        .product-card button { background-color: #ff9900; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; width: 100%; }
        .product-card button:hover { background-color: #cc7a00; }
        .menu-icon { font-size: 30px; cursor: pointer; }
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; right: 0; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; }
        .dropdown-content a { color: black; padding: 12px 16px; text-decoration: none; display: block; }
        .dropdown-content a:hover { background-color: #f1f1f1; }
        .dropdown:hover .dropdown-content { display: block; }
    </style>
</head>
<body>

<header>
    <h1>Toko Perlengkapan Mendaki ⛰️</h1>
    <div class="dropdown">
        <span class="menu-icon" onclick="toggleDropdown()">&#8942;</span> <div class="dropdown-content" id="myDropdown">
            <a href="#" onclick="showCart()">Keranjang (<span id="cartCount">0</span>)</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </div>
</header>

<div id="cartModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
    <div style="background:white; padding:20px; border-radius:8px; width:80%; max-width:600px;">
        <h2>Keranjang Belanja</h2>
        <ul id="cartItems"></ul>
        <p>Total: Rp. <span id="cartTotal">0</span></p>
        <button onclick="window.location.href='checkout.html'" style="background-color:#38761d; color:white; padding:10px;">Lanjutkan ke Transaksi</button>
        <button onclick="closeCart()">Tutup</button>
    </div>
</div>

<div class="product-grid" id="productGrid">
    </div>

<script>
// Data Produk (Minimal 10)
const products = [
    { id: 1, name: 'Hydropack 2L', price: 150000, image: 'https://via.placeholder.com/250x200?text=Hydropack', description: 'Tas air ringan 2 Liter.' },
    { id: 2, name: 'Daypack 30L', price: 350000, image: 'https://via.placeholder.com/250x200?text=Daypack+30L', description: 'Tas harian/pendakian singkat.' },
    { id: 3, name: 'Carrier 60L', price: 800000, image: 'https://via.placeholder.com/250x200?text=Carrier+60L', description: 'Tas punggung untuk ekspedisi.' },
    { id: 4, name: 'Tenda Dome 2P', price: 500000, image: 'https://via.placeholder.com/250x200?text=Tenda+2P', description: 'Tenda kapasitas 2 orang.' },
    { id: 5, name: 'Sleeping Bag', price: 250000, image: 'https://via.placeholder.com/250x200?text=Sleeping+Bag', description: 'Kantung tidur hangat.' },
    { id: 6, name: 'Kompor Portabel', price: 180000, image: 'https://via.placeholder.com/250x200?text=Kompor', description: 'Kompor mini untuk masak.' },
    { id: 7, name: 'Sepatu Trekking', price: 750000, image: 'https://via.placeholder.com/250x200?text=Sepatu+Trekking', description: 'Sepatu anti-selip.' },
    { id: 8, name: 'Headlamp LED', price: 90000, image: 'https://via.placeholder.com/250x200?text=Headlamp', description: 'Lampu kepala terang.' },
    { id: 9, name: 'Trekking Pole', price: 120000, image: 'https://via.placeholder.com/250x200?text=Trekking+Pole', description: 'Tongkat bantu jalan.' },
    { id: 10, name: 'Jas Hujan Ponco', price: 65000, image: 'https://via.placeholder.com/250x200?text=Jas+Hujan', description: 'Pelindung dari hujan.' }
];

let cart = JSON.parse(localStorage.getItem('cart')) || []; // Ambil keranjang dari penyimpanan lokal

// 1. Cek Login
if (sessionStorage.getItem('isLoggedIn') !== 'true') {
    window.location.href = 'login.html';
}

// 2. Fungsi Logout
function logout() {
    sessionStorage.removeItem('isLoggedIn');
    sessionStorage.removeItem('whatsappNumber');
    localStorage.removeItem('cart'); // Bersihkan keranjang
    window.location.href = 'login.html';
}

// 3. Render Produk
const productGrid = document.getElementById('productGrid');
products.forEach(product => {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
        <img src="${product.image}" alt="${product.name}">
        <h3>${product.name}</h3>
        <p>${product.description}</p>
        <p><strong>Rp. ${product.price.toLocaleString('id-ID')}</strong></p>
        <button onclick="addToCart(${product.id})">Tambah ke Keranjang</button>
    `;
    productGrid.appendChild(card);
});

// 4. Fungsi Tambah ke Keranjang
function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    const itemInCart = cart.find(item => item.id === productId);

    if (itemInCart) {
        itemInCart.quantity += 1;
    } else {
        cart.push({ ...product, quantity: 1 });
    }
    
    localStorage.setItem('cart', JSON.stringify(cart)); // Simpan ke penyimpanan lokal
    updateCartCount();
    alert(`${product.name} ditambahkan ke keranjang!`);
}

// 5. Fungsi Update Jumlah Keranjang
function updateCartCount() {
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cartCount').textContent = totalItems;
}
updateCartCount(); // Panggil saat memuat

// 6. Fungsi Tampilkan Keranjang (Modal)
function showCart() {
    const cartItemsList = document.getElementById('cartItems');
    const cartTotalElement = document.getElementById('cartTotal');
    let total = 0;

    cartItemsList.innerHTML = '';
    
    if (cart.length === 0) {
        cartItemsList.innerHTML = '<li>Keranjang Anda kosong.</li>';
    } else {
        cart.forEach(item => {
            const li = document.createElement('li');
            li.textContent = `${item.name} (x${item.quantity}) - Rp. ${(item.price * item.quantity).toLocaleString('id-ID')}`;
            cartItemsList.appendChild(li);
            total += item.price * item.quantity;
        });
    }

    cartTotalElement.textContent = total.toLocaleString('id-ID');
    document.getElementById('cartModal').style.display = 'flex';
}

function closeCart() {
    document.getElementById('cartModal').style.display = 'none';
}

function toggleDropdown() {
    document.getElementById("myDropdown").classList.toggle("show");
}
</script>

</body>
</html>
